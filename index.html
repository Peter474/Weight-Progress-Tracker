<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight Progress Tracker</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="imagee1.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Theme Color for Mobile Browsers -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Weight Tracker">
    
    <!-- Description -->
    <meta name="description" content="Track your weight progress with 7-day cycles and achieve your target weight goal">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .setup-section, .tracking-section, .results-section {
            display: none;
        }

        .setup-section.active, .tracking-section.active, .results-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 1.1em;
        }

        input[type="number"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .info-box {
            background: #f5f7ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #666;
            line-height: 1.6;
        }

        .day-entry {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .day-entry.completed {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .day-label {
            font-weight: 600;
            color: #333;
        }

        .day-input {
            width: 150px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .reset-btn {
            background: #e0e0e0;
            color: #333;
            margin-top: 20px;
        }

        .reset-btn:hover {
            background: #d0d0d0;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
            flex-wrap: wrap;
            gap: 15px;
        }

        .current-weight-display, .target-weight-display {
            display: flex;
            flex-direction: column;
        }

        .stats-bar .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .stats-bar .value {
            font-size: 1.8em;
            font-weight: bold;
            margin-top: 5px;
        }

        .history-btn {
            background: white;
            color: #667eea;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
        }

        .history-btn:hover {
            background: #f0f0f0;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e0e0e0;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #d0d0d0;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .history-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .history-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .history-table tr:hover {
            background: #f5f5f5;
        }

        @media (max-width: 600px) {
            .stats-bar {
                flex-direction: column;
                text-align: center;
            }
            
            .current-weight-display, .target-weight-display {
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ Weight Progress Tracker</h1>

        <!-- Always visible stats bar -->
        <div class="stats-bar" id="statsBar" style="display:none;">
            <div class="current-weight-display">
                <span class="label">Current Weight:</span>
                <span class="value" id="currentWeightDisplay">--</span> kg
            </div>
            <div class="target-weight-display">
                <span class="label">Target:</span>
                <span class="value" id="targetWeightDisplayTop">--</span> kg
            </div>
            <button class="history-btn" onclick="showWeightHistory()">ðŸ“Š View History</button>
        </div>

        <!-- Setup Section -->
        <div class="setup-section active" id="setupSection">
            <div class="info-box">
                <h3>Welcome to Your Weight Journey!</h3>
                <p>Enter your information below and we'll calculate your ideal target weight based on your body metrics.</p>
            </div>
            
            <div class="form-group">
                <label for="userHeight">Your Height (cm):</label>
                <input type="number" id="userHeight" step="0.1" placeholder="e.g., 175" required>
            </div>

            <div class="form-group">
                <label for="userAge">Your Age (years):</label>
                <input type="number" id="userAge" placeholder="e.g., 25" required>
            </div>

            <div class="form-group">
                <label for="currentWeight">Your Current Weight (kg):</label>
                <input type="number" id="currentWeight" step="0.1" placeholder="e.g., 85.5" required>
            </div>

            <div class="info-box" id="targetWeightInfo" style="display:none; background: #e8f5e9; border-left-color: #4caf50;">
                <h3>Your Ideal Target Weight</h3>
                <p style="font-size: 1.5em; font-weight: bold; color: #4caf50; margin: 10px 0;"><span id="calculatedTarget">--</span> kg</p>
                <p style="font-size: 0.9em; color: #666;">Based on healthy BMI range (18.5-24.9) for your height and age</p>
            </div>

            <button onclick="calculateTargetWeight()">Calculate My Target Weight</button>
            <button onclick="startTracking()" id="startTrackingBtn" style="display:none; margin-top: 10px;">Start First 7-Day Cycle</button>
        </div>

        <!-- Tracking Section -->
        <div class="tracking-section" id="trackingSection">
            <div class="info-box">
                <h3>Daily Weight Tracking</h3>
                <p>Enter your weight for each day. After 7 days, we'll calculate your average and show your progress!</p>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0/7 Days</div>
            </div>

            <div id="dayEntries"></div>

            <button onclick="calculateResults()" id="calculateBtn" style="display:none;">View Results</button>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <div class="info-box">
                <h3>Cycle #<span id="cycleNumber">1</span> Complete!</h3>
                <p>Great job completing this 7-day cycle. You can start a new cycle to continue tracking your progress.</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Target Weight</div>
                    <div class="stat-value" id="targetWeightDisplay">-</div>
                    <div class="stat-label">kg</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Weight</div>
                    <div class="stat-value" id="averageWeight">-</div>
                    <div class="stat-label">kg</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Progress</div>
                    <div class="stat-value" id="progressAmount">-</div>
                    <div class="stat-label">kg</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="weightChart"></canvas>
            </div>

            <div class="chart-container" id="historyCyclesChart" style="display:none;">
                <h3 style="margin-bottom: 15px;">All Cycles History</h3>
                <canvas id="cyclesChart"></canvas>
            </div>

            <button onclick="startNewCycle()">Start Next 7-Day Cycle</button>
            <button class="reset-btn" onclick="viewAllData()">View All Saved Data</button>
            <button class="reset-btn" onclick="resetApp()">Reset Everything</button>
        </div>
    </div>

    <!-- Weight History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHistoryModal()">Ã—</button>
            <h2 style="color: #667eea; margin-bottom: 20px;">ðŸ“Š Complete Weight History</h2>
            
            <div class="info-box">
                <h3>Summary</h3>
                <p><strong>Total Cycles:</strong> <span id="totalCycles">0</span></p>
                <p><strong>Starting Weight:</strong> <span id="historyStartWeight">--</span> kg</p>
                <p><strong>Current Average:</strong> <span id="historyCurrentWeight">--</span> kg</p>
                <p><strong>Total Progress:</strong> <span id="historyTotalProgress">--</span> kg</p>
            </div>

            <h3 style="margin: 30px 0 15px 0;">All Cycles</h3>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>Cycle #</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Average Weight</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>

            <div class="chart-container" id="modalHistoryChart" style="display:none;">
                <canvas id="modalCyclesChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let trackerData = {
            userHeight: 0,
            userAge: 0,
            initialWeight: 0,
            targetWeight: 0,
            cycles: [],
            currentCycle: {
                cycleNumber: 1,
                dailyWeights: [],
                startDate: null
            }
        };

        // Load saved data on page load
        window.onload = function() {
            const saved = localStorage.getItem('weightTrackerData');
            if (saved) {
                trackerData = JSON.parse(saved);
                
                if (trackerData.cycles.length > 0 || trackerData.currentCycle.dailyWeights.length > 0) {
                    updateStatsBar();
                    
                    if (trackerData.currentCycle && trackerData.currentCycle.dailyWeights.length > 0) {
                        showSection('trackingSection');
                        renderDayEntries();
                        updateProgress();
                        if (trackerData.currentCycle.dailyWeights.filter(w => w > 0).length === 7) {
                            document.getElementById('calculateBtn').style.display = 'block';
                        }
                    }
                }
            }
            
            logDataToConsole();
        };

        function logDataToConsole() {
            console.log('=== WEIGHT TRACKER DATA ===');
            console.log('Height:', trackerData.userHeight, 'cm');
            console.log('Age:', trackerData.userAge, 'years');
            console.log('Target Weight:', trackerData.targetWeight, 'kg');
            console.log('Initial Weight:', trackerData.initialWeight, 'kg');
            console.log('Completed Cycles:', trackerData.cycles.length);
            console.log('Current Cycle:', trackerData.currentCycle.cycleNumber);
            console.log('All Data:', trackerData);
            console.log('========================');
        }

        function saveData() {
            localStorage.setItem('weightTrackerData', JSON.stringify(trackerData));
            
            console.log('=== DATA SAVED ===');
            console.log('Timestamp:', new Date().toLocaleString());
            console.log('Completed Cycles:', trackerData.cycles.length);
            console.log('Current Cycle:', trackerData.currentCycle.cycleNumber);
            console.log('Current Daily Weights:', trackerData.currentCycle.dailyWeights);
            console.log('Full Data:', trackerData);
            console.log('==================');
        }

        function calculateTargetWeight() {
            const height = parseFloat(document.getElementById('userHeight').value);
            const age = parseFloat(document.getElementById('userAge').value);
            const current = parseFloat(document.getElementById('currentWeight').value);

            if (!height || !age || !current) {
                alert('Please fill in all fields!');
                return;
            }

            // Calculate ideal weight based on healthy BMI
            // For adults, using BMI of 22 (middle of healthy range 18.5-24.9)
            const heightInMeters = height / 100;
            const idealBMI = 22;
            const targetWeight = idealBMI * (heightInMeters * heightInMeters);

            trackerData.userHeight = height;
            trackerData.userAge = age;
            trackerData.initialWeight = current;
            trackerData.targetWeight = Math.round(targetWeight * 10) / 10;

            document.getElementById('calculatedTarget').textContent = trackerData.targetWeight;
            document.getElementById('targetWeightInfo').style.display = 'block';
            document.getElementById('startTrackingBtn').style.display = 'block';

            console.log('=== TARGET WEIGHT CALCULATED ===');
            console.log('Height:', height, 'cm');
            console.log('Age:', age, 'years');
            console.log('Current Weight:', current, 'kg');
            console.log('Calculated Target:', trackerData.targetWeight, 'kg');
            console.log('================================');
        }

        function startTracking() {
            if (!trackerData.targetWeight) {
                alert('Please calculate your target weight first!');
                return;
            }

            trackerData.currentCycle = {
                cycleNumber: 1,
                dailyWeights: [],
                startDate: new Date().toISOString()
            };

            saveData();
            updateStatsBar();
            showSection('trackingSection');
            renderDayEntries();
        }

        function updateStatsBar() {
            const statsBar = document.getElementById('statsBar');
            statsBar.style.display = 'flex';
            
            // Get current weight (latest average or initial)
            let currentWeight = trackerData.initialWeight;
            if (trackerData.cycles.length > 0) {
                currentWeight = trackerData.cycles[trackerData.cycles.length - 1].average;
            }
            
            document.getElementById('currentWeightDisplay').textContent = currentWeight.toFixed(1);
            document.getElementById('targetWeightDisplayTop').textContent = trackerData.targetWeight.toFixed(1);
        }

        function showSection(sectionId) {
            document.querySelectorAll('.setup-section, .tracking-section, .results-section').forEach(el => {
                el.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        function renderDayEntries() {
            const container = document.getElementById('dayEntries');
            container.innerHTML = '';

            const cycleInfo = document.createElement('div');
            cycleInfo.className = 'info-box';
            cycleInfo.innerHTML = `<h3>Cycle #${trackerData.currentCycle.cycleNumber}</h3><p>Enter your weight for each day below.</p>`;
            container.appendChild(cycleInfo);

            for (let i = 0; i < 7; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-entry' + (trackerData.currentCycle.dailyWeights[i] ? ' completed' : '');
                
                const date = new Date(trackerData.currentCycle.startDate || new Date());
                date.setDate(date.getDate() + i);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                dayDiv.innerHTML = `
                    <div class="day-label">Day ${i + 1} - ${dateStr}</div>
                    <input type="number" 
                           class="day-input" 
                           id="day${i}" 
                           step="0.1" 
                           placeholder="Weight (kg)"
                           value="${trackerData.currentCycle.dailyWeights[i] || ''}"
                           onchange="updateWeight(${i}, this.value)">
                `;
                container.appendChild(dayDiv);
            }
        }

        function updateWeight(dayIndex, value) {
            const weight = parseFloat(value);
            if (weight && weight > 0) {
                trackerData.currentCycle.dailyWeights[dayIndex] = weight;
                saveData();
                updateProgress();
                
                const filledDays = trackerData.currentCycle.dailyWeights.filter(w => w > 0).length;
                if (filledDays === 7) {
                    document.getElementById('calculateBtn').style.display = 'block';
                }
                
                document.getElementById(`day${dayIndex}`).parentElement.classList.add('completed');
            }
        }

        function updateProgress() {
            const filledDays = trackerData.currentCycle.dailyWeights.filter(w => w > 0).length;
            const progressFill = document.getElementById('progressFill');
            const percentage = (filledDays / 7) * 100;
            progressFill.style.width = percentage + '%';
            progressFill.textContent = `${filledDays}/7 Days`;
        }

        function calculateResults() {
            const validWeights = trackerData.currentCycle.dailyWeights.filter(w => w > 0);
            
            if (validWeights.length !== 7) {
                alert('Please enter weight for all 7 days!');
                return;
            }

            const average = validWeights.reduce((sum, w) => sum + w, 0) / validWeights.length;
            const previousAverage = trackerData.cycles.length > 0 
                ? trackerData.cycles[trackerData.cycles.length - 1].average 
                : trackerData.initialWeight;
            const progress = previousAverage - average;

            trackerData.currentCycle.average = average;
            trackerData.currentCycle.endDate = new Date().toISOString();
            trackerData.cycles.push({...trackerData.currentCycle});
            
            saveData();
            updateStatsBar();

            document.getElementById('cycleNumber').textContent = trackerData.currentCycle.cycleNumber;
            document.getElementById('targetWeightDisplay').textContent = trackerData.targetWeight.toFixed(1);
            document.getElementById('averageWeight').textContent = average.toFixed(1);
            document.getElementById('progressAmount').textContent = progress.toFixed(1);

            showSection('resultsSection');
            renderChart(validWeights, average);
            
            if (trackerData.cycles.length > 1) {
                renderCyclesHistory();
            }

            console.log('=== CYCLE COMPLETE ===');
            console.log('Cycle Number:', trackerData.currentCycle.cycleNumber);
            console.log('Average Weight:', average.toFixed(2), 'kg');
            console.log('Progress:', progress.toFixed(2), 'kg');
            console.log('=====================');
        }

        function renderChart(weights, average) {
            const ctx = document.getElementById('weightChart').getContext('2d');
            
            if (window.weightChart) {
                window.weightChart.destroy();
            }

            const labels = weights.map((_, i) => `Day ${i + 1}`);
            
            window.weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Daily Weight',
                            data: weights,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        },
                        {
                            label: 'Cycle Average',
                            data: Array(7).fill(average),
                            borderColor: '#4caf50',
                            borderDash: [5, 5],
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        },
                        {
                            label: 'Target Weight',
                            data: Array(7).fill(trackerData.targetWeight),
                            borderColor: '#ff6b6b',
                            borderDash: [10, 5],
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: `Cycle #${trackerData.currentCycle.cycleNumber} - 7-Day Weight Progress`,
                            font: {
                                size: 18,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Weight (kg)'
                            }
                        }
                    }
                }
            });
        }

        function renderCyclesHistory() {
            const container = document.getElementById('historyCyclesChart');
            container.style.display = 'block';
            
            const ctx = document.getElementById('cyclesChart').getContext('2d');
            
            if (window.cyclesChart) {
                window.cyclesChart.destroy();
            }

            const labels = trackerData.cycles.map((c, i) => `Cycle ${c.cycleNumber}`);
            const averages = trackerData.cycles.map(c => c.average);
            
            window.cyclesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Average Weight per Cycle',
                            data: averages,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 8,
                            pointHoverRadius: 10
                        },
                        {
                            label: 'Target Weight',
                            data: Array(trackerData.cycles.length).fill(trackerData.targetWeight),
                            borderColor: '#ff6b6b',
                            borderDash: [10, 5],
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Weight Progress Across All Cycles',
                            font: {
                                size: 18,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Average Weight (kg)'
                            }
                        }
                    }
                }
            });
        }

        function startNewCycle() {
            const lastAverage = trackerData.cycles[trackerData.cycles.length - 1].average;
            
            trackerData.currentCycle = {
                cycleNumber: trackerData.cycles.length + 1,
                dailyWeights: [],
                startDate: new Date().toISOString()
            };

            saveData();
            showSection('trackingSection');
            renderDayEntries();
            updateProgress();
            document.getElementById('calculateBtn').style.display = 'none';

            console.log('=== NEW CYCLE STARTED ===');
            console.log('Cycle Number:', trackerData.currentCycle.cycleNumber);
            console.log('Starting from average:', lastAverage.toFixed(2), 'kg');
            console.log('========================');
        }

        function showWeightHistory() {
            if (trackerData.cycles.length === 0) {
                alert('No completed cycles yet! Complete your first 7-day cycle to see history.');
                return;
            }

            const modal = document.getElementById('historyModal');
            modal.classList.add('active');

            // Update summary
            const currentWeight = trackerData.cycles[trackerData.cycles.length - 1].average;
            const totalProgress = trackerData.initialWeight - currentWeight;

            document.getElementById('totalCycles').textContent = trackerData.cycles.length;
            document.getElementById('historyStartWeight').textContent = trackerData.initialWeight.toFixed(1);
            document.getElementById('historyCurrentWeight').textContent = currentWeight.toFixed(1);
            document.getElementById('historyTotalProgress').textContent = totalProgress.toFixed(1);

            // Populate table
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';

            trackerData.cycles.forEach((cycle, index) => {
                const tr = document.createElement('tr');
                const previousWeight = index === 0 ? trackerData.initialWeight : trackerData.cycles[index - 1].average;
                const progress = previousWeight - cycle.average;
                
                tr.innerHTML = `
                    <td>Cycle ${cycle.cycleNumber}</td>
                    <td>${new Date(cycle.startDate).toLocaleDateString()}</td>
                    <td>${new Date(cycle.endDate).toLocaleDateString()}</td>
                    <td><strong>${cycle.average.toFixed(1)} kg</strong></td>
                    <td style="color: ${progress >= 0 ? '#4caf50' : '#ff6b6b'}">
                        ${progress >= 0 ? '-' : '+'}${Math.abs(progress).toFixed(1)} kg
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Render chart in modal
            if (trackerData.cycles.length > 1) {
                document.getElementById('modalHistoryChart').style.display = 'block';
                renderModalChart();
            }
        }

        function renderModalChart() {
            const ctx = document.getElementById('modalCyclesChart').getContext('2d');
            
            if (window.modalChart) {
                window.modalChart.destroy();
            }

            const labels = trackerData.cycles.map(c => `Cycle ${c.cycleNumber}`);
            const averages = trackerData.cycles.map(c => c.average);
            
            window.modalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Average Weight per Cycle',
                            data: averages,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 8,
                            pointHoverRadius: 10
                        },
                        {
                            label: 'Target Weight',
                            data: Array(trackerData.cycles.length).fill(trackerData.targetWeight),
                            borderColor: '#ff6b6b',
                            borderDash: [10, 5],
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Average Weight (kg)'
                            }
                        }
                    }
                }
            });
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('active');
        }

        function viewAllData() {
            console.log('=== COMPLETE WEIGHT TRACKER DATA ===');
            console.log('Height:', trackerData.userHeight, 'cm');
            console.log('Age:', trackerData.userAge, 'years');
            console.log('Target Weight:', trackerData.targetWeight, 'kg');
            console.log('Initial Weight:', trackerData.initialWeight, 'kg');
            console.log('Total Completed Cycles:', trackerData.cycles.length);
            console.log('\nCycles History:');
            trackerData.cycles.forEach((cycle, index) => {
                console.log(`\nCycle ${cycle.cycleNumber}:`);
                console.log('  Daily Weights:', cycle.dailyWeights);
                console.log('  Average:', cycle.average.toFixed(2), 'kg');
                console.log('  Start Date:', new Date(cycle.startDate).toLocaleDateString());
                console.log('  End Date:', new Date(cycle.endDate).toLocaleDateString());
            });
            console.log('\nCurrent Cycle:', trackerData.currentCycle);
            console.log('\nFull Data Object:', trackerData);
            console.log('====================================');
            
            alert('All data has been logged to the browser console! Press F12 to view.');
        }

        function resetApp() {
            if (confirm('Are you sure you want to RESET EVERYTHING? All cycles and data will be permanently deleted!')) {
                localStorage.removeItem('weightTrackerData');
                trackerData = {
                    userHeight: 0,
                    userAge: 0,
                    initialWeight: 0,
                    targetWeight: 0,
                    cycles: [],
                    currentCycle: {
                        cycleNumber: 1,
                        dailyWeights: [],
                        startDate: null
                    }
                };
                document.getElementById('statsBar').style.display = 'none';
                showSection('setupSection');
                document.getElementById('userHeight').value = '';
                document.getElementById('userAge').value = '';
                document.getElementById('currentWeight').value = '';
                document.getElementById('targetWeightInfo').style.display = 'none';
                document.getElementById('startTrackingBtn').style.display = 'none';
                
                console.log('=== DATA RESET ===');
                console.log('All data has been cleared');
                console.log('==================');
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('historyModal');
            if (event.target === modal) {
                closeHistoryModal();
            }
        }
    </script>
</body>

</html>



